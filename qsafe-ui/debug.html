<!DOCTYPE html>
<html>
<head>
    <title>Debug Contract Calls</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>Debug Contract Calls</h1>
    <button onclick="testContract()">Test Contract Call</button>
    <div id="output"></div>

    <script>
        const CONTRACT_ADDRESS = "0x47DB09A2489d40Ed2C038973433dBd121896bDba";
        const CONTRACT_ABI = [
            "function registerKey(bytes32 publicKeyHash) external",
            "function registeredKeys(address) external view returns (bytes32)"
        ];

        async function testContract() {
            const output = document.getElementById('output');
            output.innerHTML = "Testing...";
            
            try {
                if (!window.ethereum) {
                    output.innerHTML = "MetaMask not found!";
                    return;
                }

                const provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                const signer = provider.getSigner();
                const address = await signer.getAddress();
                
                output.innerHTML += `<br>Connected: ${address}`;
                
                const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                // Test read function first
                const existingKey = await contract.registeredKeys(address);
                output.innerHTML += `<br>Existing key: ${existingKey}`;
                
                // Test write function
                const testHash = "0x1234567890123456789012345678901234567890123456789012345678901234";
                output.innerHTML += `<br>Calling registerKey...`;
                
                const tx = await contract.registerKey(testHash);
                output.innerHTML += `<br>Transaction sent: ${tx.hash}`;
                
                const receipt = await tx.wait();
                output.innerHTML += `<br>Transaction confirmed: ${receipt.transactionHash}`;
                
            } catch (error) {
                output.innerHTML += `<br>ERROR: ${error.message}`;
                console.error(error);
            }
        }
    </script>
</body>
</html>